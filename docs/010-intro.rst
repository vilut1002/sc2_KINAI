
개요
=====

여기서는 전체 시스템의 구조와 게임의 규칙을 설명한다.

시스템 구조
------------

::

   sc2minigame
    ├── run_sc2minigame.py: 게임 실행 파일
    ├── docs: 문서파일 모음
    ├── sc2_data: sc2minigame 지도와 데이터 파일 모음
    ├── sc2_patch: python-sc2 패치 모듈
    ├── sc2_utils: python-sc2와 관련된 코드 모음
    ├── toolbox: 유용한 코드 모음
    └── bots: AI 모음
          ├── nc_example_v0.dummy_bot: 아무 행동도 하지 않는 예제
          ├── nc_example_v1.rush_bot: 적 사령부로 바로 공격하는 예제
          ├── nc_example_v2.simple_combat_bot: 기본 모듈 구조 구현한 예제
          ├── nc_example_v3.push_bot: 현재 병력 규모에 따라 전선을 전진시키는 예제
          ├── nc_example_v4.army_bot: 유닛 종류에 따라 다른 액션을 결정하는 예제
          ├── nc_example_v5.reaper_bot: 사신을 이용한 후방 기습공격 하는 예제
          ├── nc_example_v6.drop_bot: 의료선을 이용한 적 사령부 드랍공격 예제
          └── nc_example_v7.q_bot: Q-Learning 예제


시스템의 대부분은 python-sc2를 이용하기 때문에, sc2minigame 플랫폼에
고유한 요소는 sc2_data에 있는 게임 지도와 sc2_patch 모듈에 있다.

게임 지도에는 게임의 규칙이 구현되어 있다.

sc2_patch 모듈은 기존 python-sc2에서 변경하고자 하는 부분을 구현했다.
새로 게임 실행 스크립트나, 학습 코드를 구현할 때
:code:`import sc2_patch` 는 반드시 :code:`import sc2` (python-sc2)
보다 위에 있어야 한다. python-sc2를 임포트 한 뒤에 sc2_patch를 임포트 하면,
python-sc2의 행동을 패치할 수 없다.

.. warning::

   sc2_patch는 반드시 python-sc2보다 먼저 임포트 해야함


sc2_utils와 toolbox는 편의를 위한 코드 조각 모음이고, run_sc2minigame.py는
게임을 python-sc2를 이용해 게임을 실행하는 예제 중 하나이다.

그리고, bots 폴더에는 총 일곱 개의 예제 AI가 제공된다.
bot은 AI를 뜻하는 표현 중 하나이고, python-sc2 에서는 AI를 Bot AI 라고 표현한다.
각각의 예제는 순서대로 하나씩 기능을 추가하여 최종적으로는
간단한 강화학습까지 적용하는 것을 보여준다.

자세한 설명은 해당 봇과 관련된 별도의 문서에 기록한다.


게임 규칙
---------

**기본 규칙**

이 게임에서 플레이어(AI)는 자동으로 생산되는 제한된 종류의 유닛을 이용해서
지역 점령과 전투만을 수행한다. 게임의 최종 목표는 자신의 사령부를 지키면서
적의 사령부를 파괴하는 것이다. 만약 게임시간 15분이 지나도록 어느 사령부도
파괴되지 않으면 지금까지 얻은 자원의 총량을 비교하여 승패를 가린다.

지도는 Simple64.SC2Map 맵을 수정한 NCFellowship-2019-m1-v{N}.SC2Map을 사용한다.
이 지도 두 명의 플레이어를 위한 대칭 구조인 맵이다. 지도 양 끝에는 언덕이 있고,
언덕위에 플레이어들의 사령부가 있다.

게임을 시작하자 마자 사령부와 해병 다섯이 주어지고,
사령부가 있는 언덕의 입구에 있는 보급소 세 개,
그리고 중요 지점에 있는 포탑 벙커 등 방어 건물들이 기본으로 주어진다.

게임 시작할 때 주어지는 사령부는 건설로봇 생산이나, 이륙/착률등 모든 행동이 불가능하다.
건설 로봇이 없기 때문에, 추가 건물 생산뿐만 아니라 수리가 불가능하기 때문에,
건물(사령부, 벙커, 자동포탑, 보급소)에 자동 수리 기능이 추가되어 있다.
단, 테란 건물은 일정 수준 이상의 피해를 입으면 화재가 발생해 자동으로 체력이 소모되는데,
자동 수리속도 보다 빠르기 때문에 화재가 발생하면 해당 건물이
파되되는 것을 막을 수 는 없다.

**자원**

지도에는 총 다섯개의 중요지점이 있는데, 플레이어들의 본진과(2개), 지도 중앙(1개),
그리고 지도 중앙과 플레이어들의 본진 사이 공터(2개)가 있다.
이 중요지점을 점령하고 있으면(아군 유닛은 있지만, 적군 유닛은 없으면) 게임시간 2.5초마다
자원이 추가된다. 본진과 지도 중앙은 2.5초마다 광물이 1씩 추가되고, 공터는 2씩 추가된다.

2.5초마다 얻게되는 현재 자원의 양은 베스핀으로 표시된다.
배스핀을 실제로 자원으로 사용하지는 않지만, AI 플레이어가 API 정보를 알기 쉽도록
배스핀으로 표시했다.

중요지점을 점령하면 보급량이 25씩 추가된다.
보급량이 부족하면 더이상 유닛이 자동생산되지 않는다.

**유닛생산**

광물이 10이 되면, 광물 10을 소모하여 사령부에서 유닛을 생산한다.
다섯 가지 종류의 유닛이 순서에 따라 생산된다. 생산되는 순서는 다음과 같다.
공성전차까지 생산되고 나면 다시 0번 해병부터 반복한다.

.. list-table:: 유닛 생산
   :header-rows: 1

   * - 생산 순번
     - 유닛 타입
   * - 0
     - 해병
   * - 1
     - 의료선
   * - 2
     - 해병
   * - 3
     - 불곰
   * - 4
     - 해병
   * - 5
     - 불곰
   * - 6
     - 해병
   * - 7
     - 사신
   * - 8
     - 해병
   * - 9
     - 공성전차

**그 외 특이사항**

플레이어는 추가로 기술 업그레이드를 할 수 없다. 따라서, 전술 적으로 사용할 수 있는
일부 업그레이드는 기본적으로 제공된다. 그리고, 사신을 전략적으로 사용할 수 있도록
밤까마귀의 자동포탑 설치 능력을 사신에게 추가했다.

   - 해병과 불곰은 전투자극제(스팀팩) 업그레이드가 되어 있다.
   - 불곰은 충격탄 업그레이드가 되어있다.
   - 모근 건물은 중장갑 업그레이드가 되어있다.
   - 벙커는 신소재 강철 업그레이드가 되어있다.
   - 사신은 니트로 추진기 업그레이드가 되어있다.
   - 사신에 에너지 수치 150 부여
   - 사신이 자동포탑 설치(에너지 50 사용) 가능

**기본 전략**

게임 시작할 때부터 플레이어는 본진위치 에서 광물 1, 공터에서 광물 2를 얻을 수 있다.
따라서 첫 번째 전투는 지도 중앙 지점에 있는 광물 1 생산지점을 두고 벌어질 것이다.
지도 중앙에는 서로 자동포탑 두 개와 벙커를 가지고 있다.
자동 포탑과 벙커는 서로 상대방의 건물을 사거리안에 두고 있지만, 시야가 제한되서
사격이 불가능하다. 게임 초반에 주어지는 해병 다섯과, 곳 생산되는 해병 + 의료선으로
시야를 확보하면서 건물을 이용해 중앙 지점을 장악하는 것이 첫 번째 문제이다.

중앙지점을 장악한 플레이어는 자원 생산속도가 4:3으로 앞서기 때문에 시간을 끌 수록
방어에 유리해지고, 이 상태를 유지하기만 해도 자원 생산 점수 때문에 결국 승리하게 된다.

중앙지점을 점령하지 못한 플레이어는 본진 근처의 언덕과 공터 주변의 건물을 이용해
한번 더 방어할 수 있는 기회를 가질 수 있고, 곧 생산되는 사신과 공성전차 등을 이용해
반격할 수 있는 기회를 가질 수 있다.

다수의 공성전차가 지키고 있는 지점을 점령하기는 어렵기 때문에, 상대방의 공터 지점이,
사신을 이용한 기습공격이나, 드랍의 목표지점이 된다.
이 지점의 점령에 성공하면 자원 생산이 5:2로 크게 앞서게 되고,
점령에 성공하지 못하더라도, 아군 유닛을 해당 지점에 배치하여
상대방 자원 생산을 방해하기만 해도 3:2로 자원 생산에서 앞설 수 있다.

만약 중앙을 점령한 플레이어가 이것을 막기 위해 중앙지점의 방어 병력을 빼내게 되면,
중앙 지점의 방어가 취약해지는 효과도 있다.

마지막 전략으로는 상대방 사령부로 직접 기습 공격을 가하는 방법이 있는데,
상대방 사령부에서는 계속 유닛이 생산되기 때문에, 충분한 공격병력을 준비할 필요가 있다.
가장 쉬운 방법은 사신 셋을 모아서 한번에 자동포탑 9개를 설치하는 것이다.
다만, 사신 셋이 모일 때 쯤이면 서로 상당한 병력(공성전차만 세 대)을 가지고
있을 것이기 때문에, 상당히 운이 필요할 것으로 생각된다.

